version: 2

models:
  - name: stocks_gold
    description: "stock information table after cleaning and adding features"
    columns:
      - name: date
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              name: "date_not_in_future"
              expression: "<= current_date()"
      - name: ticker
        tests:
          - not_null
      - name: close
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              name: "close_positive"
              expression: "> 0"
      - name: high
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              name: "high_positive"
              expression: "> 0"
      - name: low
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              name: "low_positive"
              expression: "> 0"
      - name: adj_close
        tests:
          - dbt_utils.expression_is_true:
              name: "adj_close_positive"
              expression: ">0"
      - name: volume
        tests:
          - dbt_utils.expression_is_true:
              name: "volume_positive"
              expression: ">= 0"
      - name: event_key
        tests:
          - not_null
          - unique
    tests:
      - dbt_utils.expression_is_true:
          name: "ohlc_consistency"
          expression: "close >= low - 1e-6 and close <= high + 1e-6 and high >= low"
